<form
  class="mt-2 mb-3"
  [formGroup]="memberForm"
  (submit)="save()"
>
  <div class="form-group">
    <label
      class="mb-0 text-uppercase text-bold text-gray-light small"
      for="inputFirstname"
    >
      First name
    </label>

    <input
      type="text"
      id="inputFirstname"
      formControlName="firstname"
      class="form-control form-control-warning"
      [class.is-invalid]="isFieldInvalid('firstname')"
      placeholder="First name"
    />

    <small class="invalid-feedback">Please enter at least 2 characters. This field is required.</small>
  </div>

  <div class="form-group">
    <label
      class="mb-0 text-uppercase text-bold text-gray-light small"
      for="inputFirstname"
    >
      Last name
    </label>

    <input
      type="text"
      id="inputLastname"
      formControlName="lastname"
      class="form-control form-control-warning"
      [class.is-invalid]="isFieldInvalid('lastname')"
      placeholder="Last name"
    />

    <small class="invalid-feedback">Please enter at least 2 characters.</small>
  </div>

  <div class="form-group">
    <label
      class="mb-0 text-uppercase text-bold text-gray-light small"
    >
      Profile Image
    </label>

    <maptio-image-upload
      [imageUrl]="picture"
      [userId]="memberId"
      (uploadedImageUrl)="onImageUpload($event)"
      (errorMessage)="onImageUploadError($event)"
      [class.is-invalid]="imageUploadErrorMessage"
    ></maptio-image-upload>

    <small class="invalid-feedback">{{ imageUploadErrorMessage }}</small>
  </div>

  <div class="form-group">
    <label
      class="mb-0 text-uppercase text-bold text-gray-light small"
      for="inputEmail"
    >
      Email
    </label>

    <input
      type="text"
      id="inputEmail"
      formControlName="email"
      class="form-control form-control-warning"
      [class.is-invalid]="isFieldInvalid('email')"
      placeholder="Email"
    />

    <small class="invalid-feedback">Please enter a valid email</small>
  </div>

  <span
    *ngIf="isSavingSuccess"
    class="text-green mx-1 flash small"
    [class.show]="isSavingSuccess"
  >
    <i class="fas fa-save"></i>
    Successfully saved!
  </span>

  <span
    *ngIf="savingFailedMessage"
    class="text-danger mx-1 small"
  >
    {{ savingFailedMessage }}
  </span>

  <div
    *ngIf="!duplicateUsers.length"
    class="d-flex justify-content-end mt-2"
  >
    <button
      *ngIf="showCancelButton && !(memberForm.dirty || isNewImageUploaded)"
      type="button"
      class="btn btn-outline-secondary mr-2"
      (click)="onCancel()"
    >
      Cancel
    </button>

    <button
      *ngIf="showCancelButton && (memberForm.dirty || isNewImageUploaded)"
      type="button"
      class="btn btn-outline-secondary mr-2"
      placement="top"
      container="body"
      mwlConfirmationPopover
      [popoverTitle]="'Warning'"
      [popoverMessage]="'Cancelling will reject any unsaved changes. This cannot be undone. Are you sure?'"
      (confirm)="onCancel()"
      focusbutton="cancel"
      appendToBody="false"
    >
      Cancel
    </button>

    <button
      type="submit"
      class="btn btn-success"
      [disabled]="isSubmissionAttempted && !memberForm.valid"
    >
      Save
    </button>
  </div>

  <span class="text-green" *ngIf="isSaving">
    <i class="fas fa-circle-notch fa-spin mx-1"></i>
    Creating
  </span>

  <div
    *ngIf="duplicateUsers.length"
    class="alert alert-warning"
    role="alert"
  >
    <p>Another user with this email address is already registered with Maptio:</p>

    <maptio-member
      *ngFor="let duplicateUser of duplicateUsers"
      [member]="duplicateUser"
      class="d-block mb-2"
    ></maptio-member>

    Would you like to merge these two accounts or edit the email of the current team member?

    <div class="d-flex justify-content-end mt-3">
      <button
        type="button"
        class="btn btn-outline-secondary mr-2"
        (click)="onCancelMergingDuplicateUsers()"
      >
        Edit email
      </button>

      <button
        type="button"
        class="btn btn-success"
        (click)="onMergeDuplicateUsers()"
      >
        Merge users
      </button>
    </div>
  </div>
</form>
