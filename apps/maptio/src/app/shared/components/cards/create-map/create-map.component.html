<form [formGroup]="form" (submit)="submit()" class="d-flex flex-column">
  <ng-container
    *permissionsOnly="
      Permissions.canCreateMap;
      else elseCreateMapBlock;
      then: thenCreateMapBlock
    "
  >
    main
  </ng-container>

  <ng-template #thenCreateMapBlock>
    <div class="form-group">
      <label class="lead" for="inputMapName" i18n="@@createnewmap">
        Create a new map
      </label>
      <input
        type="text"
        id="inputMapName"
        formControlName="mapName"
        [class.is-invalid]="
          form.controls['mapName'].invalid &&
          (form.controls['mapName'].dirty || form.controls['mapName'].touched)
        "
        class="form-control w-100"
        required
      />
      <small class="invalid-feedback" i18n>
        Please enter at least 2 characters
      </small>
    </div>

    <div class="form-group" *ngIf="teams?.length > 1">
      <label for="inputTeamName" i18n="@@organisation">Organisation</label>
      <select
        id="inputTeamName"
        formControlName="teamId"
        required
        class="form-control"
      >
        <option
          value="null"
          disabled="true"
          [selected]="teams?.length > 1"
          i18n
        >
          Select an organisation
        </option>
        <option
          *ngFor="let team of teams; let i = index"
          [value]="team.team_id"
          [selected]="teams?.length === 1 && i === 0"
        >
          {{ team?.name }}
        </option>
      </select>
      <a *ngIf="teams?.length === 0" class="text-green" routerLink="/teams">
        <small class="offset-md-6" i18n="@@donthaveorganisation">
          Don't have a organisation?
        </small>
      </a>
    </div>
    <div class="d-flex justify-content-end">
      <button
        *ngIf="!isCreatingMap"
        type="submit"
        class="btn btn-success pull-right"
        i18n="@@create"
      >
        Create
      </button>
      <div
        *ngIf="isCreatingMap"
        class="text-green d-flex justify-content-end align-items-center"
        i18n
      >
        <i class="fas fa-circle-notch fa-spin text-green mx-1"></i>
        Creating
      </div>
    </div>
  </ng-template>

  <ng-template #permissionsTipContent>
    <span class="text-orange">
      <ng-container i18n>
        You don't have permission to create maps.
      </ng-container>
      <a href="{{ KB_URL_PERMISSIONS }}" target="blank" i18n>Learn more.</a>
    </span>
  </ng-template>

  <ng-template #elseCreateMapBlock>
    <div [stickyPopover]="permissionsTipContent">
      <div class="form-group">
        <label class="lead" for="inputMapName" i18n="@@createnewmap">
          Create a new map
        </label>
        <input
          type="text"
          id="inputMapName"
          class="form-control w-100 cursor-not-allowed"
          disabled
        />
      </div>

      <div class="form-group" *ngIf="teams?.length > 1">
        <label for="inputTeamName" i18n="@@organisation">Organisation</label>
        <select
          id="inputTeamName"
          disabled
          class="form-control cursor-not-allowed"
        ></select>
        <a *ngIf="teams?.length === 0" class="text-green" routerLink="/teams">
          <small class="offset-md-6" i18n="@@donthaveorganisation">
            Don't have a organisation?
          </small>
        </a>
      </div>

      <div class="d-flex justify-content-end">
        <button
          type="submit"
          class="btn btn-success pull-right cursor-not-allowed"
          disabled
          i18n="@@create"
        >
          Create
        </button>
      </div>
    </div>
  </ng-template>
</form>
