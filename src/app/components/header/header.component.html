<nav class="navbar navbar-toggleable-md navbar-light bg-faded fixed-top">
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarToggler" aria-controls="navbarToggler"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand " routerLink="home">
        <!-- <div alt="Maptio Home" class="d-inline-block align-top brand-logo" ></div> -->
        <picture>
            <source srcset="/assets/images/logo-full.webp" type="image/webp">
            <source srcset="/assets/images/logo-full.png" type="image/png">
            <img src="/assets/images/logo-full.webp" alt="Maptio logo">
        </picture>
    </a>

    <span class="navbar-text col-6 pt-2 ">
        <a class="lead" routerLink="/map/{{selectedDataset?._id}}/{{selectedDataset?.initiative?.getSlug()}}/initiatives">{{selectedDataset?.initiative?.name}}</a>

        <small class="row ml-4" *ngIf="team">
            <span class="text-muted mr-1">Team </span>
            <a routerLink="/team/{{team?.team_id}}/{{team?.getSlug()}}">
                {{team?.name}}
            </a>
            <span (click)="isMembersToggled=!isMembersToggled">
                <i class="fa fa-caret-up pt-1 pl-1" *ngIf="isMembersToggled" aria-hidden="true"></i>
                <i class="fa fa-caret-down pt-1 pl-1" *ngIf="!isMembersToggled" aria-hidden="true"></i>
            </span>

        </small>
    </span>

    <div class="collapse navbar-collapse" id="navbarToggler">
        <ul class="navbar-nav ml-auto mt-2 mt-md-0">

            <li class="nav-item dropdown" *ngIf="auth.allAuthenticated()">
                <a class="nav-link dropdown-toggle" [class.disabled]="(datasets$ | async)?.length === 0" id="mapsListDropdownLink" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    Maps
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="mapsListDropdownLink">
                    <a class="dropdown-item" (click)="goTo(dataset)" *ngFor="let dataset of datasets$ | async">
                        {{dataset?.name}}
                    </a>
                </div>
            </li>
            <li>
                <div class="collapse" id="collapseExample">

                </div>

            </li>
            <li class="nav-item dropdown" *ngIf="auth.allAuthenticated()">

                <a *ngIf="(teams$ | async)?.length > 0" class="nav-link dropdown-toggle without-caret" (mouseenter)="isCreateMode=true" (click)="isCreateMode=!isCreateMode"
                    [class.coloured]="isCreateMode">
                    Create a map
                    <i class="fa" [class.fa-caret-up]="isCreateMode" [class.fa-caret-down]="!isCreateMode" aria-hidden="true"></i>

                </a>
                <a *ngIf="(teams$ | async)?.length === 0" class="nav-link dropdown-toggle without-caret text-success" (click)="createTeam()"
                    [class.coloured]="isCreateMode">
                    Create a team
                </a>
            </li>

            <li class="nav-item dropdown" id="profileInformation" *ngIf="auth.allAuthenticated()">
                <a class="nav-link dropdown-toggle without-caret" id="profileDropdownLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <div>
                        <img src="{{ user?.picture }}" class="rounded-circle profile-image" alt="">
                    </div>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="profileDropdownLink">
                    <a class="dropdown-item" routerLink="{{user?.shortid}}/{{user?.getSlug()}}">Profile</a>
                    <a class="dropdown-item" routerLink="/teams">My teams</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" (click)="logout()" id="logoutButton">
                        <i class="fa fa-sign-out text-muted" aria-hidden="true"></i> Log Out</a>
                </div>
            </li>
            <li class="nav-link" id="loginButton" *ngIf="!auth.allAuthenticated()">

                <form class="form-inline" [formGroup]="loginForm" (submit)="login()">
                    <div class="form-group mr-1" [class.has-warning]="loginForm.controls['email'].invalid  && (loginForm.controls['email'].dirty || loginForm.controls['email'].touched)">
                        <input type="email" id="inputEmail" formControlName="email" class="form-control form-control-sm  form-control-warning" placeholder="Email"
                            required email>
                    </div>
                    <div class="form-group mr-1" [class.has-warning]="loginForm.controls['password'].invalid  && (loginForm.controls['password'].dirty || loginForm.controls['password'].touched)">

                        <input id="inputPassword" type="password" class="form-control form-control-sm form-control-warning" formControlName="password"
                            placeholder="e.g. ••••••••" autocomplete="on">
                    </div>


                    <button type="submit" class="btn btn-success btn-sm" [class.disabled]="!loginForm.valid">Log in</button>
                </form>
                <small class="text-muted col-7 pull-right">
                    <a routerLink="/forgot">Forgot your password?</a>
                </small>
            </li>
        </ul>
    </div>
</nav>
<nav class="navbar navbar-toggleable-md navbar-light bg-faded fixed-top toggeable" [class.toggled]="isMembersToggled">
    <span class="col" *ngIf="isMembersToggled">
        <a *ngFor="let user of members" class="btn btn-link btn-xs no-padding" [class.deleted]="user.isDeleted" routerLink="/map/{{selectedDataset?._id}}/{{selectedDataset?.initiative?.getSlug()}}/u/{{user.shortid}}/{{user.getSlug()}}">

            <img *ngIf="!isPictureLoadedMap.get(user?.user_id)" class="blur member rounded-circle" [@fadeInOut]="isFadeInMap.get(user?.user_id)"
                alt="image" [src]="image" />
            <img class="member rounded-circle" [@fadeInOut]="isFadeOutMap.get(user?.user_id)" alt="" [src]="user?.picture" (load)="isPictureLoaded(user?.user_id)"
                placement="bottom" container="body" ngbTooltip="{{user?.name}}" />
        </a>
        <a class="btn btn-link btn-xs no-padding" routerLink="/team/{{team?.team_id}}/{{team?.getSlug()}}" placement="bottom" container="body"
            ngbTooltip="Add team member">
            <i class="fa fa-user-plus text-muted" aria-hidden="true"></i>
        </a>
    </span>
</nav>

<div class="card creation borderless col-6 rounded-0" *ngIf="isCreateMode" (mouseleave)="isCreateMode=false">
    <div class="card-block">
        <div class="card-text">
            <form [formGroup]="createMapForm" (submit)="createDataset()" class="form-inline">
                <input type="text" id="inputMapName" formControlName="mapName" class="form-control col-6" placeholder="Enter map name " required>
                <select formControlName="teamId" required class="form-control col-4 mr-1">
                    <option *ngFor="let team of teams$ | async" [value]="team.team_id">{{team?.name}}</option>
                </select>

                <button type="submit" class="btn btn-success pull-right" [class.disabled]="!createMapForm.valid">Create</button>
            </form>
            <a *ngIf="(teams$ | async)?.length === 0 " class="text-danger" (click)="createTeam()">
                <small class="offset-md-6">Don't have a team?</small>
            </a>


        </div>
    </div>
</div>