<ng-template #rt let-r="result" let-t="term">
	<img src="{{r.picture}}" class="rounded-circle authority" /> {{r.name}}
</ng-template>

<form>
	<fieldset>
		<div class="mb-3">
			<div class="row">
				<div class="col-xl-12 mt-3">
					<input type="text" [disabled]="isReadOnly" class="form-control unresizable" id="inputName" type="text" name="inputName" [ngModelOptions]="{standalone: true}"
					 [ngModel]="node?.name" placeholder="Initiative name" (ngModelChange)="saveName($event)" rows="2" cols="" (blur)="onBlur()"
					/>
				</div>
			</div>
		</div>
		<div class="card mb-3">
			<div class="card-block">
				<div class="row justify-content-between no-gutters">
					<label for="inputAccountable" class="form-control-label col-form-label">Authority
						<!-- <span class="help-popup" placement="top" container="body" ngbTooltip="The authority is the source of the initiative"></span> -->

					</label>

					<div class="ml-2 col">

						<!-- <span *ngIf="searching">searching...</span> -->
						<div class="input-group">
							<!-- <span class="input-group-addon transparent" *ngIf="node?.accountable?.picture"><img class="rounded-circle authority" src="{{node?.accountable?.picture}}" /></span> -->
							<input #person [disabled]="isReadOnly" required="required" [resultTemplate]="rt" type="text" id="inputAccountable" placeholder="Who's accountable for this? Enter a team member"
							 [ngStyle]="{'background': ' url(' + node?.accountable?.picture + ') no-repeat'}" class="form-control background" [class.borderless-left]="node?.accountable?.picture"
							 [class.borderless-right]="!isReadOnly" [ngModelOptions]="{standalone: true}" [ngModel]="node?.accountable" (selectItem)="saveAccountable($event)"
							 [ngbTypeahead]="searchTeamMember" [resultFormatter]="formatter" [inputFormatter]="formatter" (blur)="onBlur()" />

							<span *ngIf="!isReadOnly" class="input-group-addon remove text-danger" (click)="removeAuthority()" placement="top" container="body"
							 ngbTooltip="Clear"></span>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-xl-12 mt-3" [hidden]="isReadOnly">
						<textarea #inputDescription class="form-control initiativeMarkdownDescription" id="inputDescription" [ngModelOptions]="{standalone: true}"
						 data-provide="markdown-editable" data-iconlibrary="fa" data-autofocus="true" [ngModel]="node?.description || ''" rows="5"
						 placeholder='Describe the initiative in your own words and/or add a URL to your main resource' (ngModelChange)="saveDescription($event)"
						 (blur)="onBlur()" (change)="saveDescription($event.target.value)"></textarea>
					</div>
					<div [hidden]="!isReadOnly" class="col-xl-12 mt-3">
						<markdown *ngIf="node?.description" [data]="node?.description || ''"></markdown>
					</div>
				</div>
			</div>
		</div>

		<div class="card mb-3 overflow">
			<div class="card-block">
				<h6 class="card-subtitle mb-2 text-muted">Whoâ€™s helping with this initiative?
					<!-- <span class="help-popup" placement="top" container="body" ngbTooltip="A source is rarely able to fully manifest their initiative alone. They usually need help.
						
						Helpers bring specific ideas and carry out actions to realise the vision"></span> -->
				</h6>
				<div class="input-group mb-3" *ngIf="!isReadOnly">
					<input #person [disabled]="isReadOnly" required="required" [resultTemplate]="rt" type="text" id="inputHelper" placeholder="Who's helping? Enter a team member"
					 class="form-control" (selectItem)="saveHelper($event)" [ngbTypeahead]="searchTeamMember" [resultFormatter]="formatter"
					 [inputFormatter]="formatter" />
					<button class="btn btn-success input-group-addon" (click)="addHelper()">Add</button>
				</div>

				<div class="col-lg-12">
					<div *ngFor="let user of node?.helpers; let i=index">
						<div class="row mb-2">
							<span *ngIf="!isReadOnly" class="remove text-danger mr-1 " (click)="removeHelper(user)" placement="top" container="body"
							 ngbTooltip="Remove helper">

							</span>
							<span class="col-10">
								<img src="{{user.picture}}" width="16" class="rounded-circle">
								<a routerLink="/summary/map/{{datasetId}}/{{(dataset$ | async)?.initiative?.getSlug()}}/u/{{user.shortid}}/{{user.getSlug()}}">{{user.name}}</a>

							</span>
							<button class="btn btn-link pull-right" (click)="toggleRole(i)">Edit</button>
						</div>
						<textarea [hidden]="!hideme[i]" #inputRole class="form-control form-control-sm unresizable" id="inputRole" [ngModelOptions]="{standalone: true}"
						 data-provide="markdown" data-iconlibrary="fa" data-autofocus="true" [ngModel]="user.roles[0]?.description || ''" rows="3"
						 placeholder="How is {{user.name}} helping?" (ngModelChange)="saveRole(user,$event)" (blur)="onBlur();toggleRole(i)"
						 (change)="saveRole(user,$event.target.value)"></textarea>

						<markdown class="small" [hidden]="hideme[i]" *ngIf="user.roles[0]?.description" [data]="user.roles[0]?.description || ''"></markdown>
					</div>
					<small class="text-warning" *ngIf="node?.helpers.length === 0 || !(node?.helpers)">No helpers yet</small>

				</div>
			</div>
		</div>
	</fieldset>
</form>