<div class="card" *ngIf="dataset">
    <div class="card-body d-flex flex-column">
        <div class="card-title text-bold">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <b *ngIf="!isEditing" class="">
                        <a routerLink="/map/{{dataset?.datasetId}}/{{dataset?.initiative.getSlug()}}/circles"> {{dataset?.initiative.name}}</a>
                    </b>
                    <form *ngIf="isEditing" class="form-group form-inline d-flex align-items-start" [formGroup]="form" (submit)="save()">
                        <div>
                            <input class="form-control form-control-sm mr-1" formControlName="mapName" required [class.is-invalid]="form.controls['mapName'].invalid  && (form.controls['mapName'].dirty || form.controls['mapName'].touched)"
                                value="{{dataset?.initiative.name}}" *ngIf="isEditing" type="text">
                            <small class="invalid-feedback">
                                Required
                            </small>
                            <small class="text-danger" *ngIf="isUpdateFailed">
                                Update failed!
                            </small>
                        </div>

                        <button class="btn btn-success btn-sm" type="submit">Save</button>
                        <button class="btn btn-link btn-sm" (click)="isEditing=false">Cancel</button>
                    </form>
                </div>
                <button *ngIf="isEditAvailable" class="btn btn-link btn-sm" [class.d-none]="isEditing" (click)="isEditing=true">Rename</button>
            </div>

        </div>
        <div class="card-subtitle" *ngIf="isTeamDisplayed">
            Organization
            <a routerLink="/teams/{{dataset?.team?.team_id}}/{{dataset?.team?.getSlug()}}">{{dataset?.team?.name}}</a>

        </div>
        <div class="card-subtitle mt-2 text-muted small">
            <div class="d-flex justify-content-between">
                <span *ngIf="dataset?.initiative.children">
                    <div *ngIf="dataset?.initiative.children[0]?.accountable" class="text-muted">Vision held by
                        <img class="rounded-circle" width="32" height="32" src="{{dataset?.initiative.children[0]?.accountable?.picture}}" alt="{{dataset?.initiative.children[0]?.accountable?.name}}">
                        <a class="text-muted" routerLink="/map/{{dataset?.datasetId}}/{{dataset?.initiative.getSlug()}}/summary" 
                        [queryParams]="{member: dataset?.initiative.children[0]?.accountable?.shortid}">
                            <span> {{dataset?.initiative.children[0]?.accountable?.name}}</span>
                        </a>

                    </div>

                    <div *ngIf="!dataset?.initiative.children[0]?.accountable" class="text-warning">
                        No vision holder yet.
                    </div>
                </span>
            </div>

        </div>



    </div>
    <div class="card-footer border-top-0">
        <div class="small d-flex justify-content-between align-items-center">
            <div>{{dataset?.depth}} {{dataset?.depth
                < 1 ? "sub-circle" : "sub-circles"}}</div>
                    <button *ngIf="isExportAvailable" class="btn btn-sm btn-link cursor-pointer " (click)="export(dataset)">
                        <i class="fa fa-table" aria-hidden="true"></i>
                        <span *ngIf="!isExporting">Export</span>
                        <span class="text-muted" *ngIf="isExporting">Exporting</span>
                    </button>
            </div>
        </div>
    </div>